name: Deploy to SFTP (SSH)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: {}

concurrency:
  group: deploy-sftp
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # VALGFRIT: hvis du faktisk bygger noget (ellers kan du fjerne Node-steps)
      #- name: Setup Node
      #  uses: actions/setup-node@v4
      #  with:
      #    node-version: "20"
      #    cache: "npm"

      # Hvis du har build:
      # - run: npm ci
      # - run: npm run build
      #   (og s√• deploy fx ./dist i stedet for ./)

      - name: Install sshpass
        run: sudo apt-get install -y sshpass

      - name: Deploy with rsync over SSH (password)
        run: |
          sshpass -p "${{ secrets.FTP_PASSWORD }}" rsync -avz --delete \
            -e "ssh -p 22 -o StrictHostKeyChecking=no" \
            ./ \
            ${{ secrets.FTP_USERNAME }}@${{ secrets.FTP_SERVER }}:/webroots/282b42a4/
